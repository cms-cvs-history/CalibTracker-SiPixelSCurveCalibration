process pixelscurvecalib = 
{
   #PLEASE NOTE!!: Set the "PrintPixelHistos" flag down below
   #to true if you would like to see scurves for all pixels.
   #Occasionally, the ROOT cammand gStyle->SetOptFit() is needed
   #to view the results of the function fit.
   untracked PSet maxEvents = {untracked int32 input = -1}

######################################################
#  Read settings from the calibration database 
######################################################

   include "CondCore/DBCommon/data/CondDBCommon.cfi"
# name of the database 
   replace CondDBCommon.connect = "sqlite_file:/afs/cern.ch/cms/Tracker/Pixel/configuration/TestDatabase.db"
   replace CondDBCommon.timetype = "runnumber"
   replace CondDBCommon.DBParameters.messageLevel = 0
   replace CondDBCommon.DBParameters.authenticationPath="."
   es_source = PoolDBESSource {
	using CondDBCommon
	VPSet toGet = { { 
			string record = "SiPixelCalibConfigurationRcd"
			# change the tag appropriately. Look at /afs/cern.ch/cms/Tracker/Pixel/configuration/TestDatabase.txt for existing tag names.
			string tag = "HC-Z1_HD1_B01_02_03_SCurve_23Aug07_1851"
			} }
   }

#############################################
   # Input source
   include "IORawData/SiPixelInputSources/data/PixelSLinkDataInputSource.cfi"
   replace PixelSLinkDataInputSource.fileNames={'file:SCurve_pilot_TIF_beforeInsert_BmO_D1-2_BLD8-9_FED39.dmp'}
   replace PixelSLinkDataInputSource.fedid=39
	
  # cabling
  #include "CondCore/DBCommon/data/CondDBCommon.cfi"
  #replace CondDBCommon.connect = "sqlite_file:cabling.db"
  #replace CondDBCommon.catalog = "file:cablingCatalog.xml"
  #replace CondDBCommon.timetype = "runnumber"
  #replace CondDBCommon.DBParameters.messageLevel = 1
  #replace CondDBCommon.DBParameters.authenticationPath="."
  #es_source = PoolDBESSource {
  #  using CondDBCommon
  #  VPSet toGet={{string record="SiPixelFedCablingMapRcd" string tag="SiPixelFedCablingMap_v8"}}
  #}

  # Pixel Cabling Map from DataBase
  include "CalibTracker/Configuration/data/SiPixel_TIFCabling.cff"

  # Tracker SimGeometryXML
  include "Geometry/TrackerSimData/data/trackerSimGeometryXML.cfi"
  
  # Tracker Geometry Builder
  include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
 
  # Tracker Numbering Builder
  include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"

  # Pixel RawToDigi conversion
  include "EventFilter/SiPixelRawToDigi/data/SiPixelRawToDigi.cfi"
  replace siPixelDigis.InputLabel = "source"


  service = TFileService {string fileName = "dummy_raw.root" }

   # Message Logger
#   include "FWCore/MessageLogger/data/MessageLogger.cfi"
#   or use your own 
   service = MessageLogger {	
	untracked vstring destinations = {"cout"}
	untracked PSet cout = {untracked string threshold = "DEBUG"}
	#untracked PSet default = {untracked int32 limit = 10} # surpresses error messages in case of corrupt data files used as input for RawToDigi conversion
   }



  include "CalibTracker/SiPixelSCurveCalibration/data/SiPixelSCurveCalibrationAnalysis.cfi" 	
  replace scurve.fedid = 39
  replace scurve.OutputTxtFile = "dummy_raw.txt"
  #replace scurve.PrintPixelHistos = true
	
   # module execution
   path p = { siPixelDigis, scurve }
}

