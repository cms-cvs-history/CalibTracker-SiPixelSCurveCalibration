process SCurveCalibration =  {
  
######################################################
#  define the number of events to run on (-1 = all)
######################################################

untracked PSet maxEvents = {untracked int32 input = -1}

#############################################
# Input source
#############################################

   include "IORawData/SiPixelInputSources/data/PixelSLinkDataInputSource.cfi"

#############################################
#   definition of the input file that contains the raw data
#   see https://twiki.cern.ch/twiki/bin/view/CMS/TIF_and_PSI_data 
#   for location of files
#############################################
   replace PixelSLinkDataInputSource.fileNames={'rfio:/castor/cern.ch/cms/store/TAC/PIXEL/FPIX/HC+Z1/SCurve_283.dmp'}

   include "CalibTracker/SiPixelGainCalibration/data/SiPixelCalibDigiProducer.cfi"



#############################################
# raw to digi
#############################################

    include "EventFilter/SiPixelRawToDigi/data/SiPixelRawToDigi.cfi"
    replace siPixelDigis.InputLabel = "source"
#############################################
# make sure the error collection is included...
#############################################
    replace siPixelDigis.IncludeErrors = true

#############################################
#   create calibdigis
#############################################

    include "CalibTracker/SiPixelGainCalibration/data/SiPixelCalibDigiProducer.cfi"
    replace siPixelCalibDigis.src = "siPixelDigis"


############################################################
# include the settings for SiPixelSCurveCalibrationAnalysis.cfi
############################################################

include "CalibTracker/SiPixelSCurveCalibration/data/SiPixelSCurveCalibrationAnalysis.cfi"

############################################################
# location of histogram output
############################################################
replace siPixelSCurveAnalysis.outputFileName = "scurve_histograms.root"

############################################################
# include DQM services
############################################################
 
    include "DQMServices/Core/data/DQM.cfg"

############################################################
# Logging options
############################################################

#service = MessageLogger {
#    untracked vstring destinations = { "output" }
#                                     
#    untracked vstring categories = { "SiPixelSCurveCalibration", "SiPixelOfflineCalibAnalysisBase" , "SiPixelSCurveCalibrationHistogramReport"}
#    untracked PSet output = {
#                untracked string threshold = "WARNING"
#                untracked PSet FwkReport  = { untracked int32 reportEvery = 200 }
#                untracked PSet SiPixelSCurveCalibration = { untracked int32 limit = 100 }
#                untracked PSet SiPixelSCurveCalibrationHistogramReport = { untracked int32 limit = 1000 }
#                untracked PSet SiPixelOfflineCalibAnalysisBase = { untracked int32 limit = 1000 }
#    }
#}

############################################################
# databases, cabling maps and geometry
############################################################

   include "CondTools/SiPixel/data/SiPixelCalibConfiguration.cfi"
   replace sipixelcalib_essource.toGet = { 
	{ 
	    string record = "SiPixelCalibConfigurationRcd"
	    # change the tag appropriately. 
	    # This tag string controls which calibration information is used and for now should match the used datafile.
	    string tag = "SCurve_283"
	},
	{ # this is cabling information, it contains the cabling map
	    string record = "SiPixelFedCablingMapRcd"
	    string tag = "SiPixelFedCablingMap_v9"
	}
    }

    include "Geometry/TrackerSimData/data/trackerSimGeometryXML.cfi"
    include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
    include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"

module filterEmptyCalibDigis = SiPixelCalibDigiFilter {}


path p = {siPixelDigis, siPixelCalibDigis, siPixelSCurveAnalysis} 

}
